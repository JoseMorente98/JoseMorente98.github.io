"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2549],{2549:(H,b,c)=>{c.r(b),c.d(b,{ProductosPageModule:()=>J});var p=c(177),g=c(4341),r=c(5150),f=c(8986),d=c(467),_=c(6013),P=c(7691),C=c(5312),o=c(3953),I=c(3656),v=c(4378),F=c(8714),T=c(6417),j=c(858),y=c(4115),M=c(1343);function k(n,l){1&n&&o.nrm(0,"img",30)}function S(n,l){if(1&n&&o.nrm(0,"img",31),2&n){const a=o.XpG();o.FS9("src",a.strImage,o.B4B)}}function A(n,l){if(1&n){const a=o.RV6();o.j41(0,"div")(1,"ion-button",32),o.bIt("click",function(){o.eBV(a);const t=o.XpG();return o.Njj(t.obtenerFoto())}),o.nrm(2,"ion-icon",33),o.EFF(3," Agregar imagen "),o.k0s()()}}function E(n,l){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const a=l.$implicit;o.Y8G("value",a.id),o.R7$(),o.JRh(a.nombre)}}function G(n,l){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const a=l.$implicit;o.Y8G("value",a.id),o.R7$(),o.JRh(a.nombre)}}function D(n,l){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const a=l.$implicit;o.Y8G("value",a.id),o.R7$(),o.JRh(a.nombre)}}let R=(()=>{var n;class l{constructor(e,t,s,i,u,m,h,z,W){this.modalController=e,this.productoService=t,this.notificacionService=s,this.navParams=i,this.categoriaService=u,this.empresaService=m,this.productoTipoService=h,this.uploadImageService=z,this.alertController=W,this.categorias=[],this.isSupported=!1,this.empresas=[],this.tipos=[],this.producto={id:0,nombre:"",descripcion:"",img:"",puedeSerVendido:1,puedeSerComprado:1,inventario:void 0,precio:"",productoTipoId:0,productoCategoriaId:0,empresaId:0,barcode:""},this.btnDisabled=!1}ngOnInit(){_.vi.isSupported().then(e=>{this.isSupported=e.supported}),this.getAllCategorias(),this.getAllEmpresas(),this.getAllProductoTipos(),this.navParams.get("producto")&&(this.producto=this.navParams.get("producto"),this.strImage=this.producto.img,console.log(this.producto))}close(){this.modalController.dismiss()}saveChanges(){0==this.producto.id?this.create():this.update()}create(){this.btnDisabled=!0,this.productoService.create(this.producto).subscribe({next:e=>{this.producto=e,this.producto.productoPlantillaId=e.id,this.btnDisabled=!1},error:e=>{this.btnDisabled=!1,this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}update(){this.btnDisabled=!0,this.productoService.update(this.producto).subscribe({next:e=>{this.modalController.dismiss(e),this.btnDisabled=!1},error:e=>{this.btnDisabled=!1,this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}getAllCategorias(){this.categoriaService.getAllCategorias().subscribe({next:e=>{this.categorias=e}})}getAllEmpresas(){this.empresaService.getAll().subscribe({next:e=>{this.empresas=e}})}getAllProductoTipos(){this.productoTipoService.getAll().subscribe({next:e=>{this.tipos=e}})}seleccionarCategoria(e){this.producto.productoCategoriaId=e.detail.value}seleccionarEmpresa(e){this.producto.empresaId=e.detail.value}seleccionarTipoProducto(e){this.producto.productoTipoId=e.detail.value}obtenerFoto(){var e=this;return(0,d.A)(function*(){try{const t=yield P.i7.getPhoto({quality:90,width:600,resultType:P.LK.DataUrl});e.strImage=t.dataUrl;const s=new FormData;s.append("file",e.dataURLtoFile(t.dataUrl,e.producto.nombre)),s.append("upload_preset",C.c.uploadPreset),s.append("cloud_name",C.c.cloudName),s.append("folder","Katachi Store/Productos"),e.btnDisabled=!0,e.uploadImageService.create(s).subscribe(i=>{e.producto.img=i.secure_url,e.btnDisabled=!1})}catch(t){e.notificacionService.presentAlert("Error",JSON.stringify(t)),e.btnDisabled=!1}})()}dataURLtoFile(e,t){let s=e.split(","),i=s[0].match(/:(.*?);/)[1],u=atob(s[1]),m=u.length,h=new Uint8Array(m);for(;m--;)h[m]=u.charCodeAt(m);return new File([h],t,{type:i})}handleRefresh(e){setTimeout(()=>{this.getAllCategorias(),this.getAllEmpresas(),this.getAllProductoTipos(),e.target.complete()},2e3)}scan(){var e=this;return(0,d.A)(function*(){if(!(yield e.requestPermissions()))return void e.presentAlert();const{barcodes:s}=yield _.vi.scan();e.producto.barcode=s[0].displayValue})()}requestPermissions(){return(0,d.A)(function*(){const{camera:e}=yield _.vi.requestPermissions();return"granted"===e||"limited"===e})()}presentAlert(){var e=this;return(0,d.A)(function*(){yield(yield e.alertController.create({header:"Permission denied",message:"Please grant camera permission to use the barcode scanner.",buttons:["OK"]})).present()})()}}return(n=l).\u0275fac=function(e){return new(e||n)(o.rXU(r.W3),o.rXU(v.o),o.rXU(F.c),o.rXU(I.y8),o.rXU(T.v),o.rXU(j.z),o.rXU(y.W),o.rXU(M.A),o.rXU(r.hG))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-form-producto"]],decls:51,vars:16,consts:[["mode","ios"],["color","primary"],["slot","start",3,"click"],["slot","icon-only","name","close-circle"],["slot","end",3,"click"],["slot","icon-only","name","barcode-outline"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[1,"ion-text-center"],["class","img-center","src","./../../../../assets/images/logo-color.png",4,"ngIf"],["class","img-center",3,"src",4,"ngIf"],[4,"ngIf"],["lines","none",1,"input-item"],["slot","start","name","text","color","primary"],["label","Nombre","labelPlacement","floating","placeholder","Nombre","type","text",3,"ngModelChange","ngModel"],["label","Descripci\xf3n","labelPlacement","floating","placeholder","Descripci\xf3n",3,"ngModelChange","ngModel","autoGrow"],["slot","start","name","cash","color","primary"],["label","Precio","labelPlacement","floating","placeholder","Precio (Solo n\xfameros)","type","text",3,"ngModelChange","ngModel"],["slot","start","name","cube","color","primary"],["label","Cantidad","labelPlacement","floating","placeholder","Cantidad","type","text",3,"ngModelChange","ngModel"],["slot","start","name","barcode","color","primary"],["label","C\xf3digo de barra","labelPlacement","floating","placeholder","C\xf3digo de barra","type","text",3,"ngModelChange","ngModel"],["slot","start","name","albums","color","primary"],["label","Categor\xedas","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],[3,"value",4,"ngFor","ngForOf"],["slot","start","name","business","color","primary"],["label","Empresas","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],["label","Tipo de Producto","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],["expand","block","color","primary",3,"click","disabled"],["name","enter","slot","start"],["src","./../../../../assets/images/logo-color.png",1,"img-center"],[1,"img-center",3,"src"],["size","small","color","primary",3,"click"],["name","image","slot","start"],[3,"value"]],template:function(e,t){1&e&&(o.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),o.bIt("click",function(){return t.close()}),o.j41(3,"ion-button"),o.nrm(4,"ion-icon",3),o.k0s()(),o.j41(5,"ion-title"),o.EFF(6,"PRODUCTO"),o.k0s(),o.j41(7,"ion-buttons",4),o.bIt("click",function(){return t.scan()}),o.j41(8,"ion-button"),o.nrm(9,"ion-icon",5),o.k0s()()()(),o.j41(10,"ion-content",6)(11,"ion-refresher",7),o.bIt("ionRefresh",function(i){return t.handleRefresh(i)}),o.nrm(12,"ion-refresher-content"),o.k0s(),o.j41(13,"div",8),o.DNE(14,k,1,0,"img",9)(15,S,1,1,"img",10)(16,A,4,0,"div",11),o.k0s(),o.j41(17,"ion-item",12),o.nrm(18,"ion-icon",13),o.j41(19,"ion-input",14),o.mxI("ngModelChange",function(i){return o.DH7(t.producto.nombre,i)||(t.producto.nombre=i),i}),o.k0s()(),o.j41(20,"ion-item",12),o.nrm(21,"ion-icon",13),o.j41(22,"ion-textarea",15),o.mxI("ngModelChange",function(i){return o.DH7(t.producto.descripcion,i)||(t.producto.descripcion=i),i}),o.k0s()(),o.j41(23,"ion-item",12),o.nrm(24,"ion-icon",16),o.j41(25,"ion-input",17),o.mxI("ngModelChange",function(i){return o.DH7(t.producto.precio,i)||(t.producto.precio=i),i}),o.k0s()(),o.j41(26,"ion-item",12),o.nrm(27,"ion-icon",18),o.j41(28,"ion-input",19),o.mxI("ngModelChange",function(i){return o.DH7(t.producto.inventario,i)||(t.producto.inventario=i),i}),o.k0s()(),o.j41(29,"ion-item",12),o.nrm(30,"ion-icon",20),o.j41(31,"ion-input",21),o.mxI("ngModelChange",function(i){return o.DH7(t.producto.barcode,i)||(t.producto.barcode=i),i}),o.k0s()(),o.j41(32,"ion-item",12),o.nrm(33,"ion-icon",22),o.j41(34,"ion-select",23),o.bIt("ionChange",function(i){return t.seleccionarCategoria(i)}),o.DNE(35,E,2,2,"ion-select-option",24),o.k0s()(),o.j41(36,"ion-item",12),o.nrm(37,"ion-icon",25),o.j41(38,"ion-select",26),o.bIt("ionChange",function(i){return t.seleccionarEmpresa(i)}),o.DNE(39,G,2,2,"ion-select-option",24),o.k0s()(),o.j41(40,"ion-item",12),o.nrm(41,"ion-icon",22),o.j41(42,"ion-select",27),o.bIt("ionChange",function(i){return t.seleccionarTipoProducto(i)}),o.DNE(43,D,2,2,"ion-select-option",24),o.k0s()()(),o.j41(44,"ion-footer")(45,"ion-toolbar")(46,"ion-row")(47,"ion-col")(48,"ion-button",28),o.bIt("click",function(){return t.saveChanges()}),o.nrm(49,"ion-icon",29),o.EFF(50," Guardar cambios "),o.k0s()()()()()),2&e&&(o.R7$(14),o.Y8G("ngIf",!t.strImage),o.R7$(),o.Y8G("ngIf",t.strImage),o.R7$(),o.Y8G("ngIf",0!=t.producto.id),o.R7$(3),o.R50("ngModel",t.producto.nombre),o.R7$(3),o.R50("ngModel",t.producto.descripcion),o.Y8G("autoGrow",!0),o.R7$(3),o.R50("ngModel",t.producto.precio),o.R7$(3),o.R50("ngModel",t.producto.inventario),o.R7$(3),o.R50("ngModel",t.producto.barcode),o.R7$(3),o.Y8G("value",t.producto.productoCategoriaId),o.R7$(),o.Y8G("ngForOf",t.categorias),o.R7$(3),o.Y8G("value",t.producto.empresaId),o.R7$(),o.Y8G("ngForOf",t.empresas),o.R7$(3),o.Y8G("value",t.producto.productoTipoId),o.R7$(),o.Y8G("ngForOf",t.tipos),o.R7$(5),o.Y8G("disabled",t.btnDisabled))},dependencies:[p.Sq,p.bT,g.BC,g.vS,r.Jm,r.QW,r.hU,r.W9,r.M0,r.eU,r.iq,r.$w,r.uz,r.To,r.Ki,r.ln,r.Nm,r.Ip,r.nc,r.BC,r.ai,r.Je,r.Gw],styles:[".img-center[_ngcontent-%COMP%]{background-size:100%;width:200px;height:200px;border-radius:15px}"]}),l})();var U=c(1551);function $(n,l){if(1&n&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"Marca:"),o.k0s(),o.EFF(3),o.k0s()),2&n){const a=o.XpG().$implicit;o.R7$(3),o.SpI(" ",a.categoria.nombre,"")}}function Y(n,l){if(1&n&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"Marca:"),o.k0s(),o.EFF(3),o.k0s()),2&n){const a=o.XpG().$implicit;o.R7$(3),o.SpI(" ",a.categoria.marca.nombre,"")}}function X(n,l){if(1&n&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"L\xednea:"),o.k0s(),o.EFF(3),o.k0s()),2&n){const a=o.XpG().$implicit;o.R7$(3),o.SpI(" ",a.categoria.nombre,"")}}function B(n,l){if(1&n){const a=o.RV6();o.j41(0,"ion-item-sliding")(1,"ion-item")(2,"div",9),o.nrm(3,"img",10),o.k0s(),o.j41(4,"ion-label")(5,"h3"),o.EFF(6),o.k0s(),o.j41(7,"p"),o.EFF(8),o.k0s(),o.DNE(9,$,4,1,"p",11)(10,Y,4,1,"p",11)(11,X,4,1,"p",11),o.k0s()(),o.j41(12,"ion-item-options")(13,"ion-item-option",7),o.bIt("click",function(){const t=o.eBV(a).$implicit,s=o.XpG();return o.Njj(s.openModalUpdate(t))}),o.nrm(14,"ion-icon",12),o.EFF(15," Actualizar "),o.k0s(),o.j41(16,"ion-item-option",13),o.bIt("click",function(){const t=o.eBV(a).$implicit,s=o.XpG();return o.Njj(s.deleteProducto(t.id))}),o.nrm(17,"ion-icon",14),o.EFF(18," Eliminar "),o.k0s()()()}if(2&n){const a=l.$implicit;o.R7$(3),o.Y8G("src",a.img,o.B4B),o.R7$(3),o.JRh(a.nombre),o.R7$(2),o.JRh(a.descripcion),o.R7$(),o.Y8G("ngIf",null==a.categoria.categoriaId),o.R7$(),o.Y8G("ngIf",null!=a.categoria.categoriaId),o.R7$(),o.Y8G("ngIf",null!=a.categoria.categoriaId)}}const N=[{path:"",component:(()=>{var n;class l{constructor(e,t,s,i,u){this.productoService=e,this.modalController=t,this.notificacionService=s,this.router=i,this.alertController=u,this.productos=[],this.strBuscar=""}ngOnInit(){this.getAll()}getAll(){this.productoService.getAll().subscribe({next:e=>{this.productos=e,console.log(this.productos)}})}openModal(){var e=this;return(0,d.A)(function*(){const t=yield e.modalController.create({component:R});yield t.present();const{data:s}=yield t.onDidDismiss();s&&e.getAll()})()}openModalUpdate(e){var t=this;return(0,d.A)(function*(){const s=yield t.modalController.create({component:R,componentProps:{producto:e}});yield s.present();const{data:i}=yield s.onDidDismiss();i&&t.getAll()})()}deleteProducto(e){var t=this;return(0,d.A)(function*(){yield(yield t.alertController.create({header:"Eliminar",message:"\xbfEst\xe1s seguro de que deseas eliminar el producto?",cssClass:"my-custom-class",buttons:[{text:"Cancelar",role:"cancel",handler:i=>{}},{text:"Aceptar",handler:()=>{t.delete(e)}}]})).present()})()}delete(e){this.productoService.delete(e).subscribe({next:t=>{this.notificacionService.presentAlert("Producto eliminado","El producto ha sido eliminado con \xe9xito."),this.getAll()},error:t=>{console.log(t),this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}handleRefresh(e){setTimeout(()=>{this.getAll(),e.target.complete()},2e3)}}return(n=l).\u0275fac=function(e){return new(e||n)(o.rXU(v.o),o.rXU(r.W3),o.rXU(F.c),o.rXU(f.Ix),o.rXU(r.hG))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-productos"]],decls:15,vars:6,consts:[["mode","ios"],["color","primary"],["placeholder","Buscar",3,"ngModelChange","ngModel"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngFor","ngForOf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add"],[1,"glass"],[3,"src"],[4,"ngIf"],["slot","bottom","name","create-outline"],["color","danger",3,"click"],["slot","bottom","name","trash-outline"]],template:function(e,t){1&e&&(o.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),o.EFF(3,"PRODUCTOS"),o.k0s()(),o.j41(4,"ion-toolbar",1)(5,"ion-searchbar",2),o.mxI("ngModelChange",function(i){return o.DH7(t.strBuscar,i)||(t.strBuscar=i),i}),o.k0s()()(),o.j41(6,"ion-content",3)(7,"ion-refresher",4),o.bIt("ionRefresh",function(i){return t.handleRefresh(i)}),o.nrm(8,"ion-refresher-content"),o.k0s(),o.j41(9,"ion-list"),o.DNE(10,B,19,6,"ion-item-sliding",5),o.nI1(11,"filter"),o.k0s(),o.j41(12,"ion-fab",6)(13,"ion-fab-button",7),o.bIt("click",function(){return t.openModal()}),o.nrm(14,"ion-icon",8),o.k0s()()()),2&e&&(o.R7$(5),o.R50("ngModel",t.strBuscar),o.R7$(),o.Y8G("fullscreen",!0),o.R7$(4),o.Y8G("ngForOf",o.i5U(11,3,t.productos,t.strBuscar)))},dependencies:[p.Sq,p.bT,g.BC,g.vS,r.W9,r.Q8,r.YW,r.eU,r.iq,r.uz,r.LU,r.CE,r.A7,r.he,r.nf,r.To,r.Ki,r.S1,r.BC,r.ai,r.Gw,U.E]}),l})()}];let O=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[f.iI.forChild(N),f.iI]}),l})();var V=c(4582);let J=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[p.MD,g.YN,r.bv,O,V.L]}),l})()}}]);