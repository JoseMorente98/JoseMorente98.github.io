"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4739],{4739:(z,_,l)=>{l.r(_),l.d(_,{ProductosPageModule:()=>V});var u=l(177),m=l(4341),n=l(5150),f=l(8986),g=l(467),P=l(7691),v=l(5312),o=l(3953),I=l(3656),b=l(4378),C=l(8714),R=l(6417),T=l(858),y=l(4115),j=l(1343);function E(i,c){1&i&&o.nrm(0,"img",25)}function M(i,c){if(1&i&&o.nrm(0,"img",26),2&i){const r=o.XpG();o.FS9("src",r.strImage,o.B4B)}}function S(i,c){if(1&i){const r=o.RV6();o.j41(0,"div")(1,"ion-button",27),o.bIt("click",function(){o.eBV(r);const e=o.XpG();return o.Njj(e.obtenerFoto())}),o.nrm(2,"ion-icon",28),o.EFF(3," Agregar imagen "),o.k0s()()}}function D(i,c){if(1&i&&(o.j41(0,"ion-select-option",29),o.EFF(1),o.k0s()),2&i){const r=c.$implicit;o.Y8G("value",r.id),o.R7$(),o.JRh(r.nombre)}}function k(i,c){if(1&i&&(o.j41(0,"ion-select-option",29),o.EFF(1),o.k0s()),2&i){const r=c.$implicit;o.Y8G("value",r.id),o.R7$(),o.JRh(r.nombre)}}function G(i,c){if(1&i&&(o.j41(0,"ion-select-option",29),o.EFF(1),o.k0s()),2&i){const r=c.$implicit;o.Y8G("value",r.id),o.R7$(),o.JRh(r.nombre)}}let F=(()=>{var i;class c{constructor(t,e,a,s,d,p,h,J){this.modalController=t,this.productoService=e,this.notificacionService=a,this.navParams=s,this.categoriaService=d,this.empresaService=p,this.productoTipoService=h,this.uploadImageService=J,this.categorias=[],this.empresas=[],this.tipos=[],this.producto={id:0,nombre:"",descripcion:"",img:"",puedeSerVendido:1,puedeSerComprado:1,inventario:void 0,precio:"",productoTipoId:0,productoCategoriaId:0,empresaId:0},this.btnDisabled=!1}ngOnInit(){this.getAllCategorias(),this.getAllEmpresas(),this.getAllProductoTipos(),this.navParams.get("producto")&&(this.producto=this.navParams.get("producto"),this.strImage=this.producto.img)}close(){this.modalController.dismiss()}saveChanges(){0==this.producto.id?this.create():this.update()}create(){this.btnDisabled=!0,this.productoService.create(this.producto).subscribe({next:t=>{this.producto=t,this.producto.productoPlantillaId=t.id,this.btnDisabled=!1},error:t=>{this.btnDisabled=!1,this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}update(){this.btnDisabled=!0,this.productoService.update(this.producto).subscribe({next:t=>{this.modalController.dismiss(t),this.btnDisabled=!1},error:t=>{this.btnDisabled=!1,this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}getAllCategorias(){this.categoriaService.getAllCategorias().subscribe({next:t=>{this.categorias=t}})}getAllEmpresas(){this.empresaService.getAll().subscribe({next:t=>{this.empresas=t}})}getAllProductoTipos(){this.productoTipoService.getAll().subscribe({next:t=>{this.tipos=t}})}seleccionarCategoria(t){this.producto.productoCategoriaId=t.detail.value}seleccionarEmpresa(t){this.producto.empresaId=t.detail.value}seleccionarTipoProducto(t){this.producto.productoTipoId=t.detail.value}obtenerFoto(){var t=this;return(0,g.A)(function*(){try{const e=yield P.i7.getPhoto({quality:90,width:600,resultType:P.LK.DataUrl});t.strImage=e.dataUrl;const a=new FormData;a.append("file",t.dataURLtoFile(e.dataUrl,t.producto.nombre)),a.append("upload_preset",v.c.uploadPreset),a.append("cloud_name",v.c.cloudName),a.append("folder","Katachi Store/Productos"),t.btnDisabled=!0,t.uploadImageService.create(a).subscribe(s=>{t.producto.img=s.secure_url,t.btnDisabled=!1})}catch(e){t.notificacionService.presentAlert("Error",JSON.stringify(e))}})()}dataURLtoFile(t,e){let a=t.split(","),s=a[0].match(/:(.*?);/)[1],d=atob(a[1]),p=d.length,h=new Uint8Array(p);for(;p--;)h[p]=d.charCodeAt(p);return new File([h],e,{type:s})}}return(i=c).\u0275fac=function(t){return new(t||i)(o.rXU(n.W3),o.rXU(b.o),o.rXU(C.c),o.rXU(I.y8),o.rXU(R.v),o.rXU(T.z),o.rXU(y.W),o.rXU(j.A))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-form-producto"]],decls:43,vars:15,consts:[["mode","ios"],["color","primary"],["slot","start",3,"click"],["slot","icon-only","name","close-circle"],[1,"ion-padding"],[1,"ion-text-center"],["class","img-center","src","./../../../../assets/images/logo-color.png",4,"ngIf"],["class","img-center",3,"src",4,"ngIf"],[4,"ngIf"],["lines","none",1,"input-item"],["slot","start","name","text","color","primary"],["placeholder","Nombre","type","text",3,"ngModelChange","ngModel"],["placeholder","Descripci\xf3n",3,"ngModelChange","ngModel","autoGrow"],["slot","start","name","cash","color","primary"],["placeholder","Precio (Solo n\xfameros)","type","text",3,"ngModelChange","ngModel"],["slot","start","name","cube","color","primary"],["placeholder","Cantidad","type","text",3,"ngModelChange","ngModel"],["slot","start","name","albums","color","primary"],["label","Categor\xedas","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],[3,"value",4,"ngFor","ngForOf"],["slot","start","name","business","color","primary"],["label","Empresas","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],["label","Tipo de Producto","placeholder","Seleccione una opci\xf3n",3,"ionChange","value"],["expand","block","color","primary",3,"click","disabled"],["name","enter","slot","start"],["src","./../../../../assets/images/logo-color.png",1,"img-center"],[1,"img-center",3,"src"],["size","small","color","primary",3,"click"],["name","image","slot","start"],[3,"value"]],template:function(t,e){1&t&&(o.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),o.bIt("click",function(){return e.close()}),o.j41(3,"ion-button"),o.nrm(4,"ion-icon",3),o.k0s()(),o.j41(5,"ion-title"),o.EFF(6,"PRODUCTO"),o.k0s()()(),o.j41(7,"ion-content",4)(8,"div",5),o.DNE(9,E,1,0,"img",6)(10,M,1,1,"img",7)(11,S,4,0,"div",8),o.k0s(),o.j41(12,"ion-item",9),o.nrm(13,"ion-icon",10),o.j41(14,"ion-input",11),o.mxI("ngModelChange",function(s){return o.DH7(e.producto.nombre,s)||(e.producto.nombre=s),s}),o.k0s()(),o.j41(15,"ion-item",9),o.nrm(16,"ion-icon",10),o.j41(17,"ion-textarea",12),o.mxI("ngModelChange",function(s){return o.DH7(e.producto.descripcion,s)||(e.producto.descripcion=s),s}),o.k0s()(),o.j41(18,"ion-item",9),o.nrm(19,"ion-icon",13),o.j41(20,"ion-input",14),o.mxI("ngModelChange",function(s){return o.DH7(e.producto.precio,s)||(e.producto.precio=s),s}),o.k0s()(),o.j41(21,"ion-item",9),o.nrm(22,"ion-icon",15),o.j41(23,"ion-input",16),o.mxI("ngModelChange",function(s){return o.DH7(e.producto.inventario,s)||(e.producto.inventario=s),s}),o.k0s()(),o.j41(24,"ion-item",9),o.nrm(25,"ion-icon",17),o.j41(26,"ion-select",18),o.bIt("ionChange",function(s){return e.seleccionarCategoria(s)}),o.DNE(27,D,2,2,"ion-select-option",19),o.k0s()(),o.j41(28,"ion-item",9),o.nrm(29,"ion-icon",20),o.j41(30,"ion-select",21),o.bIt("ionChange",function(s){return e.seleccionarEmpresa(s)}),o.DNE(31,k,2,2,"ion-select-option",19),o.k0s()(),o.j41(32,"ion-item",9),o.nrm(33,"ion-icon",17),o.j41(34,"ion-select",22),o.bIt("ionChange",function(s){return e.seleccionarTipoProducto(s)}),o.DNE(35,G,2,2,"ion-select-option",19),o.k0s()()(),o.j41(36,"ion-footer")(37,"ion-toolbar")(38,"ion-row")(39,"ion-col")(40,"ion-button",23),o.bIt("click",function(){return e.saveChanges()}),o.nrm(41,"ion-icon",24),o.EFF(42," Guardar cambios "),o.k0s()()()()()),2&t&&(o.R7$(9),o.Y8G("ngIf",!e.strImage),o.R7$(),o.Y8G("ngIf",e.strImage),o.R7$(),o.Y8G("ngIf",0!=e.producto.id),o.R7$(3),o.R50("ngModel",e.producto.nombre),o.R7$(3),o.R50("ngModel",e.producto.descripcion),o.Y8G("autoGrow",!0),o.R7$(3),o.R50("ngModel",e.producto.precio),o.R7$(3),o.R50("ngModel",e.producto.inventario),o.R7$(3),o.Y8G("value",e.producto.productoCategoriaId),o.R7$(),o.Y8G("ngForOf",e.categorias),o.R7$(3),o.Y8G("value",e.producto.empresaId),o.R7$(),o.Y8G("ngForOf",e.empresas),o.R7$(3),o.Y8G("value",e.producto.productoTipoId),o.R7$(),o.Y8G("ngForOf",e.tipos),o.R7$(5),o.Y8G("disabled",e.btnDisabled))},dependencies:[u.Sq,u.bT,m.BC,m.vS,n.Jm,n.QW,n.hU,n.W9,n.M0,n.eU,n.iq,n.$w,n.uz,n.ln,n.Nm,n.Ip,n.nc,n.BC,n.ai,n.Je,n.Gw],styles:[".img-center[_ngcontent-%COMP%]{background-size:100%;width:200px;height:200px;border-radius:15px}"]}),c})();var A=l(1551);function $(i,c){if(1&i&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"Marca:"),o.k0s(),o.EFF(3),o.k0s()),2&i){const r=o.XpG().$implicit;o.R7$(3),o.SpI(" ",r.categoria.nombre,"")}}function U(i,c){if(1&i&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"Marca:"),o.k0s(),o.EFF(3),o.k0s()),2&i){const r=o.XpG().$implicit;o.R7$(3),o.SpI(" ",r.categoria.marca.nombre,"")}}function B(i,c){if(1&i&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"L\xednea:"),o.k0s(),o.EFF(3),o.k0s()),2&i){const r=o.XpG().$implicit;o.R7$(3),o.SpI(" ",r.categoria.nombre,"")}}function Y(i,c){if(1&i){const r=o.RV6();o.j41(0,"ion-item-sliding")(1,"ion-item")(2,"div",9),o.nrm(3,"img",10),o.k0s(),o.j41(4,"ion-label")(5,"h3"),o.EFF(6),o.k0s(),o.j41(7,"p"),o.EFF(8),o.k0s(),o.DNE(9,$,4,1,"p",11)(10,U,4,1,"p",11)(11,B,4,1,"p",11),o.k0s()(),o.j41(12,"ion-item-options")(13,"ion-item-option",7),o.bIt("click",function(){const e=o.eBV(r).$implicit,a=o.XpG();return o.Njj(a.openModalUpdate(e))}),o.nrm(14,"ion-icon",12),o.EFF(15," Actualizar "),o.k0s(),o.j41(16,"ion-item-option",13),o.bIt("click",function(){const e=o.eBV(r).$implicit,a=o.XpG();return o.Njj(a.deleteProducto(e.id))}),o.nrm(17,"ion-icon",14),o.EFF(18," Eliminar "),o.k0s()()()}if(2&i){const r=c.$implicit;o.R7$(3),o.Y8G("src",r.img,o.B4B),o.R7$(3),o.JRh(r.nombre),o.R7$(2),o.JRh(r.descripcion),o.R7$(),o.Y8G("ngIf",null==r.categoria.categoriaId),o.R7$(),o.Y8G("ngIf",null!=r.categoria.categoriaId),o.R7$(),o.Y8G("ngIf",null!=r.categoria.categoriaId)}}const X=[{path:"",component:(()=>{var i;class c{constructor(t,e,a,s,d){this.productoService=t,this.modalController=e,this.notificacionService=a,this.router=s,this.alertController=d,this.productos=[],this.strBuscar="",this.empresasIDs=""}ngOnInit(){var t;this.usuario=JSON.parse(localStorage.getItem("currentUsuario")),this.empresasIDs=null===(t=this.usuario)||void 0===t?void 0:t.empresas.map(e=>e.id).join(","),this.getAllByEmpresas(this.empresasIDs)}getAllByEmpresas(t){this.productoService.getByEmpresas(t).subscribe({next:e=>{this.productos=e,console.log(this.productos)}})}openModal(){var t=this;return(0,g.A)(function*(){const e=yield t.modalController.create({component:F});yield e.present();const{data:a}=yield e.onDidDismiss();a&&t.getAllByEmpresas(t.empresasIDs)})()}openModalUpdate(t){var e=this;return(0,g.A)(function*(){const a=yield e.modalController.create({component:F,componentProps:{producto:t}});yield a.present();const{data:s}=yield a.onDidDismiss();s&&e.getAllByEmpresas(e.empresasIDs)})()}deleteProducto(t){var e=this;return(0,g.A)(function*(){yield(yield e.alertController.create({header:"Eliminar",message:"\xbfEst\xe1s seguro de que deseas eliminar el producto?",cssClass:"my-custom-class",buttons:[{text:"Cancelar",role:"cancel",handler:s=>{}},{text:"Aceptar",handler:()=>{e.delete(t)}}]})).present()})()}delete(t){this.productoService.delete(t).subscribe({next:e=>{this.notificacionService.presentAlert("Producto eliminado","El producto ha sido eliminado con \xe9xito."),this.getAllByEmpresas(this.empresasIDs)},error:e=>{console.log(e),this.notificacionService.presentToast("Algo sali\xf3 mal. Vuelve a intentar, por favor.")}})}handleRefresh(t){setTimeout(()=>{this.getAllByEmpresas(this.empresasIDs),t.target.complete()},2e3)}}return(i=c).\u0275fac=function(t){return new(t||i)(o.rXU(b.o),o.rXU(n.W3),o.rXU(C.c),o.rXU(f.Ix),o.rXU(n.hG))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-productos"]],decls:15,vars:6,consts:[["mode","ios"],["color","primary"],["placeholder","Buscar",3,"ngModelChange","ngModel"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngFor","ngForOf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add"],[1,"glass"],[3,"src"],[4,"ngIf"],["slot","bottom","name","create-outline"],["color","danger",3,"click"],["slot","bottom","name","trash-outline"]],template:function(t,e){1&t&&(o.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),o.EFF(3,"PRODUCTOS"),o.k0s()(),o.j41(4,"ion-toolbar",1)(5,"ion-searchbar",2),o.mxI("ngModelChange",function(s){return o.DH7(e.strBuscar,s)||(e.strBuscar=s),s}),o.k0s()()(),o.j41(6,"ion-content",3)(7,"ion-refresher",4),o.bIt("ionRefresh",function(s){return e.handleRefresh(s)}),o.nrm(8,"ion-refresher-content"),o.k0s(),o.j41(9,"ion-list"),o.DNE(10,Y,19,6,"ion-item-sliding",5),o.nI1(11,"filter"),o.k0s(),o.j41(12,"ion-fab",6)(13,"ion-fab-button",7),o.bIt("click",function(){return e.openModal()}),o.nrm(14,"ion-icon",8),o.k0s()()()),2&t&&(o.R7$(5),o.R50("ngModel",e.strBuscar),o.R7$(),o.Y8G("fullscreen",!0),o.R7$(4),o.Y8G("ngForOf",o.i5U(11,3,e.productos,e.strBuscar)))},dependencies:[u.Sq,u.bT,m.BC,m.vS,n.W9,n.Q8,n.YW,n.eU,n.iq,n.uz,n.LU,n.CE,n.A7,n.he,n.nf,n.To,n.Ki,n.S1,n.BC,n.ai,n.Gw,A.E]}),c})()}];let N=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[f.iI.forChild(X),f.iI]}),c})();var O=l(4582);let V=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[u.MD,m.YN,n.bv,N,O.L]}),c})()}}]);